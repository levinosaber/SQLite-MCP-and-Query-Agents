# 垃圾监管系统AI智能体

本目录包含基于LangGraph和MCP（Model Context Protocol）的AI智能体程序，用于智能查询和分析垃圾监管数据。

## 文件结构

```
agents/
├── garbage_monitoring_agent.py  # 完整版智能体（基于LangGraph）
└── README.md                   # 说明文档
```

## 功能概述

智能体实现了三个核心节点的工作流：

### 节点1：欢迎节点
- 向用户展示系统功能
- 接受用户的自然语言查询输入
- 提供预定义的查询示例

### 节点2：查询处理节点  
- 分析用户输入的自然语言需求
- 将预定义提示词与用户输入拼接
- 与大模型交互

### 节点3：追加问询节点
- 节点2的查询可能信息不足
- 这个节点用于判断是否需要向用户追问信息
- 如果不需要则继续至节点4

### 节点4：结果保存节点
- 将查询结果保存为CSV格式
- 同时保存完整的JSON格式数据
- 自动在outputs目录中创建带时间戳的文件

## 可用查询功能

### 📊 生活垃圾监管功能
1. **全区清运实时数据查询** - 查看指定日期的清运概览和明细
2. **各街道清运数量统计** - 分析特定时间段和街道的清运统计
3. **逾期混运问题整治** - 查询小包垃圾超时和垃圾桶满溢问题

### 🔧 装修垃圾监管功能  
4. **新旧模式预约数据** - 查询装修垃圾预约的新老模式数据
5. **工单状态详情分析** - 查看各状态工单的详细信息

### 🛠️ 辅助功能
6. **数据质量检查** - 检查各表数据的完整性和质量
7. **数据日期范围查询** - 获取各表可用的数据时间范围  
8. **自定义SQL查询** - 执行任意SQL查询语句

## 快速开始

### 1. 环境准备

安装必需的Python包：
```bash
uv sync
```

### 2. 配置环境变量

添加OPENAI_API_KEY这个环境变量

### 3. 运行智能体

```bash
cd shanghaichengdi
python garbage_monitoring_agent.py
```

## 输出文件说明

每次查询会在 `outputs` 目录生成以下类型的文件：

### CSV文件
- 包含结构化的查询结果数据
- 使用UTF-8 BOM编码，支持中文显示
- 文件名格式：`{工具名}_{数据类型}_{时间戳}.csv`

### JSON文件  
- 包含完整的查询结果和元数据
- 保留原始数据结构和类型信息
- 文件名格式：`{工具名}_complete_{时间戳}.json`